<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QRcode</title>
    <style>
      @import url("https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css");
      @import url("https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css");
      @import url("https://fonts.googleapis.com/css2?family=Exo+2:wght@200;400;500;600&amp;display=swap");

      /* Configurações gerais */
      body {
        background: transparent;
        font-family: "Exo 2", sans-serif;
        line-height: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Estilos para a caixa de mensagens */
      #widget {
        width: 100%;
        max-width: 200px;
        opacity: 0;
      }

      #widget.close {
        animation: boxClose 1s ease;
        opacity: 0;
      }

      #widget.open {
        animation: boxOpen 1s ease;
        opacity: 1;
      }

      #widget img {
        max-width: 100%;
      }

      #widget .site {
        width: 100%;
        font-weight: 700;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      #widget .messages {
        width: 100%;
        text-align: center;
        margin: 1rem 0;
        padding: 1rem;
        position: relative;
      }

      #widget .messages > div {
        position: absolute;
        left: 0;
        top: 0;
      }

      #widget .messages > .show {
        animation: show 1s ease;
        opacity: 1;
      }

      #widget .messages > .hide {
        animation: hide 0.5s ease;
        opacity: 0;
      }

      /* Animações */
      @keyframes boxClose {
        0% {
          opacity: 1;
          transform: translateY(0%);
        }
        to {
          opacity: 0;
          transform: translateY(-1000%);
        }
      }

      @keyframes boxOpen {
        0% {
          opacity: 0;
          transform: translateY(-1000%);
        }
        to {
          opacity: 1;
          transform: translateY(0%);
        }
      }

      @keyframes show {
        0% {
          opacity: 0;
          transform: translateY(100%);
        }
        50% {
          transform: translateY(-50%);
        }
        to {
          opacity: 1;
          transform: translateY(0%);
        }
      }

      @keyframes hide {
        0% {
          opacity: 1;
          transform: translateY(0%);
        }
        to {
          opacity: 0;
          transform: translateY(100%);
        }
      }
    </style>
  </head>
  <body>
    <div
      id="widget"
      class="close bg-white text-dark rounded-3 p-2 m-2 overflow-hidden"
    >
      <div class="site">
        <strong>{{siteUrl}}</strong>
      </div>
      <img class="rounded qrcode" />
      <div class="messages">
        <div>{{message1}}</div>
        <div>{{message2}}</div>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fitty/2.3.6/fitty.min.js"></script>
    <script>
      // Parametros que definirão os valores do Widget
      const queryParams = location.search
        .split("?")[1]
        .split("&")
        .reduce((params, param) => {
          const [key, value] = param.split("=");
          params[key.toLowerCase] = isNaN(value)
            ? String(value)
            : Number(value);
          return params;
        }, {});

      // Definição do objeto Widget
      const Widget = {
        // Variável para controlar o índice de mensagens
        idx: 0,

        // Elemento HTML que representa o widget
        boxElement: document.querySelector("#widget"),

        // Lista de mensagens do widget
        messageElements: document.querySelectorAll("#widget .messages > div"),

        // Variáveis para controlar o intervalo de exibição das mensagens
        messageInterval: null,
        messageIntervalTime: (queryParams.interval || 5) * 1000,

        // Alterna as mensagens exibidas no widget
        messageSlider() {
          if (this.idx >= this.messageElements.length) {
            this.idx = 0;
          }
          this.messageElements.forEach((el, idx) => {
            const isCurrent = idx === this.idx;
            el.classList.toggle("show", isCurrent);
            el.classList.toggle("hide", !isCurrent);
          });
          this.idx++;
        },

        // Variável para controlar o estado atual do widget
        status: "hidden",

        // Exibe o widget
        show() {
          this.boxElement.classList.remove("close");
          this.boxElement.classList.add("open");
          this.status = "shown";
          this.messageInterval = setInterval(
            () => this.messageSlider(),
            this.messageIntervalTime
          );
          this.messageSlider();
        },

        // Oculta o widget
        hide() {
          clearInterval(this.messageInterval);
          this.boxElement.classList.remove("open");
          this.boxElement.classList.add("close");
          this.status = "hidden";
        },

        // Alterna o estado do widget entre exibição e ocultação
        toggle() {
          if (this.status === "shown") {
            this.hide();
            setTimeout(
              () => this.toggle(),
              parseInt(queryParams.hide || 10) * 60000
            );
          } else {
            this.show();
            setTimeout(
              () => this.toggle(),
              parseInt(queryParams.show || 1) * 60000
            );
          }
        },

        // Atualiza a URL exibida no widget
        updateUrl(url) {
          const siteBoxElement = this.boxElement.querySelector(".site strong");
          const qrCodeElement = this.boxElement.querySelector("img.qrcode");
          if (qrCodeElement) {
            qrCodeElement.src = `https://chart.googleapis.com/chart?chs=400x400&cht=qr&chld=L|0&chl=${encodeURIComponent(
              url
            )}`;
          }
          if (siteBoxElement) {
            siteBoxElement.textContent = url.replace(/^https?:\/\//i, "");
            fitty(siteBoxElement, { multiLine: false });
          }
        },

        // Inicializa o widget
        init() {
          Array.from(this.messageElements).forEach((el, n) => {
            el.textContent = queryParams[`message${n + 1}}`] || "";
            fitty(el);
          });
          this.updateUrl(queryParams.url || "xog.one/pix");
          this.toggle();
        },
      };

      // Inicialização do widget
      onload = () => Widget.init();
    </script>
  </body>
</html>
